# Rime schema settings
# encoding: utf-8

schema:
  schema_id: flypy
  name: 小鹤单字流
  version: "1"
  author:
    - BlindingDark <blindingdark@outlook.com>
    - 宇止水 <Steveviuv@gmail.com>
  dependencies:
    - english
    - openfly_reverse

configuration:
  split_sentence: true
  use_wordninja_lua: true

switches:
  - name: ascii_punct
    states: [。，, ．，]
  - name: full_shape
    states: [ 半角, 全角 ]


style:
  horizontal: true
  # 启用内嵌编码模式
  inline_preedit: true  
  # 编码显示方式
  preedit_type: composition  

menu:
  page_size: 5

engine:
  processors:
    - ascii_composer
    - recognizer
    - key_binder
    - speller
    - punctuator
    - selector
    - navigator
    - express_editor
    - lua_processor@*chinese_number*processor

  # 分段器, 用于给输入打上标签交由后面处理
  segmentors:
    # 用于判断是不是西文模式
    - ascii_segmentor
    # 用于配合recognizer中的pattern
    - matcher
    - abc_segmentor
    - punct_segmentor
    - affix_segmentor@Latex
    - fallback_segmentor
  translators:
    - punct_translator
    - lua_translator@*date_translator
    # 计算器
    - lua_translator@*calc_translator
    # /olt 触发
    - lua_translator@*Latex
    - lua_translator@*chinese_number*translator
    # 农历
    - lua_translator@*lunar
    # UUID
    - lua_translator@*uuid
    # 数字、金额大写
    - lua_translator@*number_translator
    # 计算器
    - lua_translator@*calc_translator
    # A-Z 大写开头触发单词大写
    - lua_translator@*word_autocaps*translator
    - table_translator@term_dict
    # 主码表
    - table_translator
    # 副码表
    - table_translator@english
    - table_translator@rust_dict
    - reverse_lookup_translator
    
  filters:
    - reverse_lookup_filter@radical_reverse_lookup
    - lua_filter@*easy_en*enhance_filter
    - lua_filter@*word_autocaps*filter
    - uniquifier

# Lua 配置: 日期、时间、星期、ISO 8601、时间戳的触发关键字
date_translator:
  date: date            # 日期： 2022-11-29
  time: time            # 时间： 18:13
  week: week            # 星期： 星期二
  datetime: datetime    # ISO 8601： 2022-11-29T18:13:11+08:00
  timestamp: timestamp  # 时间戳： 1669716794

# Lua 配置：农历的触发关键字
lunar: nl  # 农历： 二〇二三年冬月二十 癸卯年（兔）冬月二十

# Lua 配置: 生成 UUID 的触发关键字
uuid: uuid

translator:
  # 中文输入
  dictionary: flypy
  enable_encoder: false
  enable_sentence: false
  enable_user_dict: false
  initial_quality: 1
  # 输入1个编码后开始提示
  spelling_hints: 1
  enable_completion: true
  encode_commit_history: false
  # 自定义编码提示格式
  comment_format:
    - xform/^(~)(.*)$/$2/

## 副词典
english:
  dictionary: english
  enable_encoder: false
  enable_sentence: true
  # 用户自造词
  enable_user_dict: false
  # 编码补全
  enable_completion: true
  # 匹配^.*$替换为空
  comment_format:
    - xform/^.*$//

# 除rust以外的专有术语表
term_dict:
  dictionary: ""
  user_dict: en_dicts/term  # 指定用户词典路径
  db_class: stabledb        # 只读数据库，无法动态调频；设为 tabledb 可以动态调频
  enable_sentence: true
  enable_completion: true  # 自动补全, 存疑bug, 关闭后无法打出词典中的词
  initial_quality: 3  # 调高权重使其更容易出现在候选项中
  enable_user_dict: true  # 用户字典, 存疑bug, 关闭后无法打出词典中的词
  comment_format:
    - xform/^.*$//


rust_dict:
  dictionary: ""
  user_dict: en_dicts/rust  # 指定用户词典路径
  db_class: stabledb
  enable_sentence: true
  enable_completion: true  # 自动补全, 存疑bug, 关闭后无法打出词典中的词
  initial_quality: 1.1  # 调高权重使其更容易出现在候选项中
  enable_user_dict: true  # 用户字典, 存疑bug, 关闭后无法打出词典中的词
  comment_format:
    - xform/^.*$//


reverse_lookup:
  dictionary: openfly_reverse
  comment_format:
    - xform/ / /

# 标点及特殊符号表情
punctuator:
  import_preset: symbols


speller:
  # 如果不想让什么标点直接上屏, 可以加在 alphabet, 或者编辑标点符号为两个及以上的映射
  alphabet: zyxwvutsrqponmlkjihgfedcbaZYXWVUTSRQPONMLKJIHGFEDCBA
  # initials 定义仅作为始码的按键，排除 ` 让单个的 ` 可以直接上屏
  # 添加.。是为了使用句号顶屏
  initials: zyxwvutsrqponmlkjihgfedcbaZYXWVUTSRQPONMLKJIHGFEDCBA
  delimiter: "`"
  #最大码长, 用于输入单词
  max_code_length: 1000
  #顶字上屏
  auto_select: true
  # 自动上屏用于中文
  auto_select_pattern: ^\w{4}$

recognizer:
  import_preset: default
  patterns:
    # 符号引导符 
    punct: "^(o[a-z]+)$"
    # 显式禁用大写模式，防止它从 default 预设中继承并拦截数字键
    uppercase: ""
    reverse_lookup: "[a-z`]*`+[a-z`]*"
    # Latex 排版
    Latex: "^(olt)(.*)$"
    calculator: "^(oca).+$"             # 响应 lua_translator@*calc_translator，计算器。前缀设定项 calculator/prefix
    radical_lookup: "^uU[a-z]+$"        # 响应部件拆字的反查，触发前缀与 radical_lookup/prefix 匹配
    number: "^R[0-9]+[.]?[0-9]*"        # 脚本将自动获取第 2 个字符 R 作为触发前缀，响应 lua_translator@*number_translator，数字金额大写
    gregorian_to_lunar: "^N[0-9]{1,8}"  # 脚本将自动获取第 2 个字符 N 作为触发前缀，响应 lua_translator@*lunar，公历转农历，输入 N20240115 得到「二〇二三年腊月初五」

calculator:
  prefix: "oca"
  show_prefix: true

key_binder:
  # 导入预设
  import_preset: default
  bindings:
    # [上翻页
    - {accept: bracketleft, send: Page_Up, when: has_menu}
    # ]下翻页
    - {accept: bracketright, send: Page_Down, when: has_menu}
    # 引号三选
    - { when: has_menu, accept: apostrophe, send: 3 }
    # 分号次选
    - {accept: semicolon, send: 2, when: has_menu}
    # # 发送当前字+句号。
    # - {accept: Release+period, send: period, when: composing}
    # # 发送当前字+逗号
    # - {accept: Release+comma, send: comma, when: composing}
    #  tab清屏
    - {accept: "Tab", send: Escape, when: composing}
    # 切换中英标点， comma 为, 号
    - {accept: "Control+comma", toggle: ascii_punct, when: always}
    - {accept: KP_0, send: 0, when: composing}
    - {accept: KP_1, send: 1, when: composing}
    - {accept: KP_2, send: 2, when: composing}
    - {accept: KP_3, send: 3, when: composing}
    - {accept: KP_4, send: 4, when: composing}
    - {accept: KP_5, send: 5, when: composing}
    - {accept: KP_6, send: 6, when: composing}
    - {accept: KP_7, send: 7, when: composing}
    - {accept: KP_8, send: 8, when: composing}
    - {accept: KP_9, send: 9, when: composing}
    - {accept: KP_Decimal,  send: period,   when: composing}
    - {accept: KP_Multiply, send: asterisk, when: composing}
    - {accept: KP_Add,      send: plus,     when: composing}
    - {accept: KP_Subtract, send: minus,    when: composing}
    - {accept: KP_Divide,   send: slash,    when: composing}
